---
description: >-
  Esg270_IrDcntRate.createIrDcntRate : 기본 테너별로 산출한 조정 무위험 금리기간구조를 smith-wilson
  방식을 적용해 전체 월별 만기구간에 대해 보간/보외
---

# 전체 기간별 할인율 (270)

## Preview

기본 테너 (3M,6M,9M,... 240M)별 SPOT RATE를 이용하여 조정 무위험 금리기간구조 (1M\~1440M) 보간/ 보외 &#x20;

<figure><img src="../../../../.gitbook/assets/image (42).png" alt=""><figcaption><p>IR_CURVE_SPOT</p></figcaption></figure>

&#x20; 기본 테너 (3M,6M,9M,... 240M)별 YTM을 이용하여 기본 무위험 금리기간구조 (1M\~1440M) 보간/ 보외&#x20;

<figure><img src="../../../../.gitbook/assets/image (83).png" alt=""><figcaption><p>IR_CURVE_YTM</p></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (80).png" alt=""><figcaption><p>IR_DCNT_RATE</p></figcaption></figure>

### 기본 무위험 금리기간구조&#x20;

* SPOT RATE, FWD RATE &#x20;
* class : `SmithWilsonKicsBts`
* <mark style="color:red;">**자산평가**</mark>를 위한 기본 무위험 금리기간구조&#x20;
* ytm 값을 그대로 가져와서 smith-wilson 보간함. _<mark style="color:red;">(YTM은 기본시나리오만 있음!!!)</mark>_
* LTFR : ytmList의 Y50 (마지막 tenor) 값&#x20;

<table data-view="cards"><thead><tr><th></th><th>entity</th><th>table</th></tr></thead><tbody><tr><td>input</td><td>IrCurveYtm</td><td>IR_CURVE_YTM</td></tr><tr><td>output</td><td>IrDcntRate</td><td>IR_DCNT_RATE</td></tr></tbody></table>



### 조정 무위험 금리기간구조&#x20;

* ADJ SPOT RATE, ADJ FWD RATE
* class : `SmithWilsonKics`
* <mark style="color:blue;">**부채평가**</mark>를 위한 조정 무위험 금리기간구조&#x20;
* spot rate (continuous) 값을 가져와서 smith-wilson 보간함. _<mark style="color:blue;">(금리 충격수준별 spot rate 산출결과)</mark>_
* LTFR  : paramSw 입력값 (금감원 제공)&#x20;

<table data-view="cards"><thead><tr><th></th><th>entity</th><th>table</th></tr></thead><tbody><tr><td>input</td><td>IrCurveSpot</td><td>IR_CURVE_SPOT</td></tr><tr><td>output</td><td>IrDcntRate</td><td>IR_DCNT_RATE</td></tr></tbody></table>



'기본 무위험 금리기간구조' 와 'base시나리오'가 둘 다 '기본(base)' 이라는 단어로 혼용될 소지가 있으므로 이하에서는 아래의 용어를 사용함. &#x20;

* 기본 무위험 금리기간구조 (LTFR, LP 반영 전) -> Asset할인율&#x20;
* 조정 무위험 금리기간구조 (LTFR, LP 반영 후) -> Liab할인율 &#x20;



## Work Detail&#x20;

irCurveNm(금리커브) 단위로 paramSw에 설정된 irCurveSceNo(시나리오)마다 아래의 작업을 반복한다.&#x20;

* K-ICS(applBizDv)의 경우 민감도 분석 목적에 따라 YTM에 직접 충격을 반영하는 경우를 처리하기 위해 작업을 구분하였음.&#x20;

1. 부채 할인율 처리&#x20;
2. \~4. 자산 할인율을 위한 처리&#x20;





### 1. Common &  for all Scen

<details>

<summary>baseScen 통 만들기 => for Asset 할인율</summary>

```java
Map<String, IrDcntRate> adjRateSce1Map       = new TreeMap<String, IrDcntRate>();
Map<String, SmithWilsonRslt> baseRateSce1Map = new TreeMap<String, SmithWilsonRslt>(); 
```

#### &#x20;Asset 할인율 (기본 무위험 금리기간구조)에 충격시나리오 반영방안&#x20;

대상

* K-ICS표준모형 : 금리위험 산출을 위해 결정론적 금리 충격시나리오를 반영함.&#x20;

문제점&#x20;

* Asset 할인율은 ytm 기반 보간 ->금리 shock 수준별 결과가 없음 (only base 시나리오)&#x20;
* Liab 할인율은  spot rate 기반 보간 -> 금리 shock 수준별 결과가 있음
* 결정론적 금리shock은 ytm에 직접 주지 않고, spot rate로 변환 후 충격을 주는 구조이기 때문.&#x20;

해결방법

* Asset 할인율에 충격수준 반영을 위해서 만기별로 충격스프레드(충격 전후의 Liab 할인율의 차이)를 산출해서 Asset 할인율 (base시나리오)에 가산하는 방식으로 산출함. (감독원 엑셀)
* 이 처리를 위해 baseScenRst 결과를 따로 집계함
  * &#x20;`adjRateSce1Map, baseRateSce1Map`

</details>

<details>

<summary>✱✱ Liab 할인율 smith-wilson 변환 (<a data-mention href="../../../undefined/smith-wilson-method/with-zero-coupon-bonds/smithwilsonkics.class.md">smithwilsonkics.class.md</a>)</summary>

{% code overflow="wrap" %}
```java
SmithWilsonKics swKics = new SmithWilsonKics
 ( baseDate
 , irCurveSpotList
 , CMPD_MTD_DISC
 , true
 , swSce.getValue().getLtfr()
 , swSce.getValue().getLtfrCp()
 , projectionYear, 1, 100, DCB_MON_DIF);
```
{% endcode %}

</details>

<details>

<summary>[<code>adjRateList</code>] Liab 할인율 -> save </summary>

{% code overflow="wrap" %}
```java
// DCNT 결과담기 (조정;Liab할인율)
List<IrDcntRate> adjRateList 
= swKics.getSmithWilsonResultList()
  .stream().map(s -> s.convert()).collect(Collectors.toList());
```
{% endcode %}

* 아직 부채할인율만 담아서 자산할인율항목(spotRate, fwdRate)은 null임&#x20;
*

    <figure><img src="../../../../.gitbook/assets/image (41).png" alt=""><figcaption></figcaption></figure>

</details>

<details>

<summary>[<code>adjRateMap</code>]  L scen</summary>

만기코드 단위로 충격스프레드 산출하기 위해 map 생성

```java
Map<String, IrDcntRate> adjRateMap 
= adjRateList.stream().collect(Collectors.toMap
 (IrDcntRate::getMatCd, Function.identity()
 , (k, v) -> k
 , TreeMap::new));				

TreeSet<Double> tenorList 
= adjRateList.stream().map
  (s -> Double.valueOf(1.0 * Integer.valueOf(s.getMatCd().substring(1)) / MONTH_IN_YEAR))
  .collect(Collectors.toCollection(TreeSet::new)); 
```

*

    <figure><img src="../../../../.gitbook/assets/image (78).png" alt=""><figcaption></figcaption></figure>

</details>

### 2. K-ICS &  only if Scen #1

<details>

<summary>[<code>adjRateSce1Map</code>]  L base</summary>

{% code overflow="wrap" %}
```java
adjRateSce1Map 
= adjRateList.stream()
 .collect(Collectors.toMap
 (IrDcntRate::getMatCd, Function.identity()
 , (k, v) -> k
 , TreeMap::new
 ));
```
{% endcode %}

* 위에서 이미 부채할인율은 smith-wilton 보간했음. 그 결과 중에 시나리오 1번은 1번 통에 담기 &#x20;
*

    <figure><img src="../../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

</details>

<details>

<summary>✱✱Asset 할인율 smith-wilson 변환</summary>

```java
List<IrCurveYtm> ytmList 
 = IrCurveYtmDao
  .getIrCurveYtm(bssd, curveSwMap.getKey());	

SmithWilsonKicsBts swBts 
 = SmithWilsonKicsBts.of()
    .baseDate(baseDate)					
    .ytmCurveHisList(ytmList)
    .alphaApplied(StringUtil.objectToPrimitive(swSce.getValue().getSwAlphaYtm(), 0.1))													 
    .freq(StringUtil.objectToPrimitive(swSce.getValue().getFreq(), 2))
    .build();

```

</details>

<details>

<summary>[<code>baseRateSce1Map</code>]  A base</summary>

{% code overflow="wrap" %}
```java
baseRateSce1Map 
 = swBts.getSmithWilsonResultList(prjTenor).stream()
	.collect(Collectors.toMap
	(SmithWilsonRslt::getMatCd, Function.identity()));
```
{% endcode %}

*

    <figure><img src="../../../../.gitbook/assets/image (81).png" alt=""><figcaption></figcaption></figure>

</details>

<details>

<summary>[<code>adjRateList</code>] Asset 할인율 -> save </summary>

{% code overflow="wrap" %}
```java
// DCNT 결과담기 (기본)  
for(IrDcntRate rslt : adjRateList) {							
    rslt.setSpotRate(baseRateSce1Map.get(rslt.getMatCd()).getSpotDisc());
    rslt.setFwdRate (baseRateSce1Map.get(rslt.getMatCd()).getFwdDisc());}
```
{% endcode %}

*

    <figure><img src="../../../../.gitbook/assets/image (31).png" alt=""><figcaption></figcaption></figure>
*

    <figure><img src="../../../../.gitbook/assets/image (30).png" alt=""><figcaption></figcaption></figure>

</details>

### 3. K-ICS &  only if Scen #2\~#5

<details>

<summary>A scen  =  A base + ( L scen - L base )  =>  L scen + (A base - L base)</summary>

* 엑셀로직  A base + ( L scen - L base ) &#x20;
  * 시나리오별 자산할인율 = 자산 기준시나리오 값에 만기별 금리충격수준 반영
* 엔진로직 . L scen + (A base - L base)
  * 시나리오별 자산 할인율 = 시나리오별 부채할인율에 만기별 자산/부채 스프레드조정 반영

```java
TreeMap<String, Double> spotRateMap = new TreeMap<String, Double>();
TreeMap<String, Double> fwdRateMap  = new TreeMap<String, Double>();

for(IrDcntRate rslt : adjRateList) {						
   String matCd   = rslt.getMatCd();						
   double adjRate = adjRateMap.get(matCd).getAdjSpotRate();
   double adjDiff = baseRateSce1Map.get(matCd).getSpotDisc(). 
         	   - adjRateSce1Map.get(matCd).getAdjSpotRate();
	
	rslt.setSpotRate(adjRate + adjDiff);						
	spotRateMap.put(matCd, adjRate + adjDiff);
}					
fwdRateMap = irSpotDiscToFwdM1Map(spotRateMap);					

for(IrDcntRate rslt : adjRateList) {
	rslt.setFwdRate(fwdRateMap.get(rslt.getMatCd()).doubleValue());
}		
```

</details>

### 4.  K-ICS 외&#x20;

<details>

<summary><del>[<code>adjRateSce1Map</code>]  L base</del></summary>

{% code overflow="wrap" %}
```java
adjRateSce1Map = adjRateList.stream().collect(Collectors.toMap(IrDcntRate::getMatCd, Function.identity(), (k, v) -> k, TreeMap::new));		
```
{% endcode %}

</details>

<details>

<summary>✱✱Asset 할인율 smith-wilson 변환</summary>

```java
List<IrCurveYtm> ytmList 
= IrDcntRateDao
 .getIrDcntRateBuToBaseSpotList(bssd, applBizDv, curveSwMap.getKey(), swSce.getKey())
 .stream().map(s -> s.convertSimpleYtm()).collect(Collectors.toList());					
//자산 할인율 
SmithWilsonKicsBts swBts 
= SmithWilsonKicsBts.of()
	 .baseDate(baseDate)					
	 .ytmCurveHisList(ytmList)
	 .alphaApplied(StringUtil.objectToPrimitive(swSce.getValue().getSwAlphaYtm(), 0.1))													 
	 .freq(0)
	 .build();								
```

</details>

<details>

<summary>[<code>baseRateSce1Map</code>]  A base</summary>

{% code overflow="wrap" %}
```java
baseRateSce1Map 
= swBts.getSmithWilsonResultList(prjTenor).stream()
 .collect(Collectors.toMap
 (SmithWilsonRslt::getMatCd, Function.identity()));		
```
{% endcode %}

</details>

<details>

<summary>[<code>adjRateList</code>] Asset 할인율 -> save</summary>

```java
for(IrDcntRate rslt : adjRateList) {						
 rslt.setSpotRate(baseRateSce1Map.get(rslt.getMatCd()).getSpotDisc());
 rslt.setFwdRate (baseRateSce1Map.get(rslt.getMatCd()).getFwdDisc());
}		
```

</details>

